---
# Fetch only the SSM parameters this node type needs (from group_vars frontend.yml / backend.yml)
- name: Retrieve SSM parameters using custom module
  ssm_params:
    client_name: "{{ client_name }}"
    client_environment: "{{ client_environment }}"
    region: "{{ aws_region }}"
    parameters: "{{ ssm_parameters_to_fetch | default(['internal_alb_dns', 'ecr_frontend_image', 'ecr_backend_image']) }}"
  register: ssm_result

- name: Set SSM parameters as facts
  set_fact:
    ssm_parameters: "{{ ssm_result.ansible_facts.ssm_parameters }}"

- name: Display retrieved parameters
  debug:
    msg: "{{ ssm_parameters | dict2items | map(attribute='value') | list }}"
  when: ssm_parameters is defined
